# 8. λ™μ  λ©”λ¨λ¦¬ κ΄€λ¦¬

# 8.1 λ™μ  λ©”λ¨λ¦¬ ν• λ‹Ή

## malloc, calloc

### π“ `malloc` ν•¨μ

#### π§Ύ κ°μ”

`malloc` ν•¨μλ” **μ§€μ •ν• λ°”μ΄νΈ μλ§νΌ μ—°μ†λ λ©”λ¨λ¦¬ λΈ”λ΅**μ„ **λ™μ μΌλ΅ ν• λ‹Ή**ν•κ³ , κ·Έ μ‹μ‘ μ£Όμ†λ¥Ό λ°ν™ν•λ‹¤.

> β οΈ λ‹¨, **ν• λ‹Ήλ λ©”λ¨λ¦¬λ” μ΄κΈ°ν™”λμ§€ μ•λ”λ‹¤.** λ”°λΌμ„ μ‚¬μ© μ „ μ΄κΈ°ν™”κ°€ ν•„μ”ν•λ‹¤.

#### π§ ν•¨μ μ›ν•

```
void *malloc(size_t size);
```

#### π“¥ λ§¤κ°λ³€μ

| λ§¤κ°λ³€μ | μ„¤λ…                              |
| -------- | --------------------------------- |
| `size`   | ν• λ‹Ήν•  λ©”λ¨λ¦¬ ν¬κΈ° (λ‹¨μ„: λ°”μ΄νΈ) |

μ: `sizeof(int) * 10` μ€ `int` 10κ° ν¬κΈ°λ§νΌ λ©”λ¨λ¦¬ ν™•λ³΄

#### π“¤ λ°ν™κ°’

| μƒν™©      | λ°ν™κ°’          |
| --------- | --------------- |
| ν• λ‹Ή μ„±κ³µ | void* ν• ν¬μΈν„° |
| ν• λ‹Ή μ‹¤ν¨ | `NULL`          |

#### π“ μ‚¬μ© μμ‹

```
#include <stdlib.h>

int *arr = (int *)malloc(sizeof(int) * 5);
if (arr == NULL) {
    // λ©”λ¨λ¦¬ λ¶€μ΅± λ“±μ μ΄μ λ΅ ν• λ‹Ή μ‹¤ν¨
}
```

#### β οΈ μ£Όμμ‚¬ν•­

- λ°ν™κ°’μ€ **void\***μ΄λ―€λ΅, ν•„μ” μ‹ μ μ ν• ν•λ³€ν™μ„ ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤ (C++μ—μ„λ” ν•„μ).
- `malloc`μΌλ΅ ν• λ‹Ήλ λ©”λ¨λ¦¬λ” λ°λ“μ‹ `free()`λ΅ ν•΄μ ν•΄μ•Ό ν•λ‹¤. κ·Έλ ‡μ§€ μ•μΌλ©΄ **λ©”λ¨λ¦¬ λ„μ**κ°€ λ°μƒν•  μ μλ‹¤.

### π“ `calloc` ν•¨μ

#### π§Ύ κ°μ”

`calloc` ν•¨μλ” **μ”μ† κ°μμ™€ κ° μ”μ†μ ν¬κΈ°λ¥Ό κΈ°λ°μΌλ΅ λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ή**ν•λ©°,
 ν• λ‹Ήλ λ¨λ“  λ©”λ¨λ¦¬ κ³µκ°„μ„ **0μΌλ΅ μ΄κΈ°ν™”**ν•λ‹¤.

> β… λ°°μ—΄μ΄λ‚ κµ¬μ΅°μ²΄λ¥Ό μ΄κΈ°ν™”λ μƒνƒλ΅ ν• λ‹Ήν•  λ• μ μ©ν•λ‹¤.

#### π§ ν•¨μ μ›ν•

```
void *calloc(size_t num_elements, size_t element_size);
```

#### π“¥ λ§¤κ°λ³€μ

| λ§¤κ°λ³€μ       | μ„¤λ…                  |
| -------------- | --------------------- |
| `num_elements` | ν• λ‹Ήν•  μ”μ†μ κ°μ    |
| `element_size` | κ° μ”μ†μ λ°”μ΄νΈ ν¬κΈ° |

μ: `calloc(5, sizeof(int))` β†’ `int` 5κ°μ— λ€ν• 0 μ΄κΈ°ν™”λ λ©”λ¨λ¦¬ ν™•λ³΄

#### π“¤ λ°ν™κ°’

| μƒν™©      | λ°ν™κ°’          |
| --------- | --------------- |
| ν• λ‹Ή μ„±κ³µ | void* ν• ν¬μΈν„° |
| ν• λ‹Ή μ‹¤ν¨ | `NULL`          |

#### π“ μ‚¬μ© μμ‹

```
#include <stdlib.h>

int *arr = (int *)calloc(5, sizeof(int));
if (arr == NULL) {
    // λ©”λ¨λ¦¬ λ¶€μ΅±
}
```

### π† `malloc` vs `calloc` λΉ„κµν‘

| ν•­λ©        | `malloc`                          | `calloc`                            |
| ----------- | --------------------------------- | ----------------------------------- |
| μ΄κΈ°ν™” μ—¬λ¶€ | β μ΄κΈ°ν™”λμ§€ μ•μ (μ“°λ κΈ°κ°’ μ΅΄μ¬) | β… 0μΌλ΅ μ΄κΈ°ν™”λ¨                    |
| μΈμ μ     | 1κ° (`μ „μ²΄ λ°”μ΄νΈ μ`)            | 2κ° (`μ”μ† κ°μ`, `μ”μ† ν¬κΈ°`)      |
| μ†λ„        | λ” λΉ λ¥Ό μ μμ                   | μ΄κΈ°ν™”λ΅ μΈν•΄ μ•½κ°„ λλ¦΄ μ μμ     |
| μ‚¬μ© μ©λ„   | λΉ λ¥΄κ² λ©”λ¨λ¦¬λ§ ν• λ‹Ήν•  λ•         | λ°°μ—΄ λλ” κµ¬μ΅°μ²΄ μ΄κΈ°ν™”κ°€ ν•„μ”ν•  λ• |

### π§  μ‹¬ν™” μ„¤λ…

#### β… μ™ `calloc`μ΄ ν•„μ”ν•κ°€?

- `calloc`μ€ λ‚΄λ¶€μ μΌλ΅ **`malloc` + `memset(0)`** κ³Ό μ μ‚¬ν•κ² λ™μ‘ν•¨.
- μλ¥Ό λ“¤μ–΄, ν¬μΈν„° λ°°μ—΄μ΄λ‚ κµ¬μ΅°μ²΄μ λ©¤λ²„ λ³€μλ¥Ό **λ…μ‹μ μΌλ΅ μ΄κΈ°ν™”ν•μ§€ μ•μ•„λ„** λλ” μ¥μ μ΄ μμ.

#### π§ μμ : μ°¨μ΄μ  ν™•μΈ

```
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *a = (int *)malloc(sizeof(int) * 5);
    int *b = (int *)calloc(5, sizeof(int));

    printf("malloc κ²°κ³Ό:\n");
    for (int i = 0; i < 5; i++) printf("%d ", a[i]); // μ΄κΈ°ν™” μ• λ¨
    printf("\n");

    printf("calloc κ²°κ³Ό:\n");
    for (int i = 0; i < 5; i++) printf("%d ", b[i]); // λ¨λ‘ 0

    free(a);
    free(b);
    return 0;
}
```

#### π§― λ©”λ¨λ¦¬ ν•΄μ  ν•„μ

```
free(arr);  // malloc, calloc κ³µν†µ ν•΄μ  λ°©λ²•
```

> π’΅ ν• λ‹Ή ν›„ μ‚¬μ©ν•μ§€ μ•λ” λ©”λ¨λ¦¬λ” λ°λ“μ‹ ν•΄μ ν•΄μ•Ό ν•λ‹¤.
>  κ·Έλ ‡μ§€ μ•μΌλ©΄ μ‹μ¤ν… μμ›μ„ μ§€μ†μ μΌλ΅ μ†λΉ„ν•μ—¬ **λ©”λ¨λ¦¬ λ„μ(leak)** λ΅ μ΄μ–΄μ§ μ μλ‹¤.

## reallocμ— μν• μ¬ν• λ‹Ή

### π“ `realloc` ν•¨μ

#### π§Ύ κ°μ”

`realloc` ν•¨μλ” κΈ°μ΅΄μ— `malloc` λλ” `calloc` λ“±μΌλ΅ λ™μ μΌλ΅ ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ ν¬κΈ°λ¥Ό λ³€κ²½ν•κ³ , λ³€κ²½λ ν¬κΈ°μ **μƒλ΅μ΄ λ©”λ¨λ¦¬ λΈ”λ΅μ μ‹μ‘ μ£Όμ†λ¥Ό λ°ν™**ν•λ‹¤.

- **ν™•μ¥ μ‹**: κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό μ μ§€ν• μ±„ ν¬κΈ°λ¥Ό λλ¦΄ μ μλ‹¤.
- **μ¶•μ† μ‹**: μ•λ¶€λ¶„ λ°μ΄ν„°λ” μ μ§€λλ©° λ’¤μ½μ€ μλ ¤λ‚κ°„λ‹¤.
- μƒλ΅ ν• λ‹Ήλ μμ—­μ€ **μ΄κΈ°ν™”λμ§€ μ•λ”λ‹¤**.

#### π§ ν•¨μ μ›ν•

```
void *realloc(void *ptr, size_t new_size);
```

#### π“¥ λ§¤κ°λ³€μ

| λ§¤κ°λ³€μ   | μ„¤λ…                                                         |
| ---------- | ------------------------------------------------------------ |
| `ptr`      | κΈ°μ΅΄μ— ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ ν¬μΈν„° (`malloc`, `calloc`, `realloc`λ΅ μ–»μ€ κ²ƒ) |
| `new_size` | λ³€κ²½ν•κ³ μ ν•λ” λ©”λ¨λ¦¬μ **μƒλ΅μ΄ ν¬κΈ°** (λ‹¨μ„: λ°”μ΄νΈ)      |

#### π“¤ λ°ν™κ°’

| μƒν™© | λ°ν™κ°’                                                |
| ---- | ----------------------------------------------------- |
| μ„±κ³µ | μƒ ν¬κΈ°λ΅ μ¬ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ μ‹μ‘ μ£Όμ† (void*)    |
| μ‹¤ν¨ | `NULL` (μ›λ λ©”λ¨λ¦¬λ” κ·Έλ€λ΅ μ μ§€λλ©°, μ†μ‹¤λμ§€ μ•μ) |

#### π’΅ μ‚¬μ© μμ‹

```
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *arr = (int *)malloc(sizeof(int) * 5);
    if (arr == NULL) return 1;

    for (int i = 0; i < 5; i++) arr[i] = i + 1;

    // ν¬κΈ°λ¥Ό 10κ°μ intλ΅ ν™•μ¥
    int *new_arr = (int *)realloc(arr, sizeof(int) * 10);
    if (new_arr == NULL) {
        // μ¬ν• λ‹Ή μ‹¤ν¨ β†’ μ›λ arrλ” μ—¬μ „ν μ ν¨ν•λ―€λ΅ ν•΄μ  ν•„μ”
        free(arr);
        return 1;
    }

    // μƒ λ©”λ¨λ¦¬ μ‚¬μ©
    for (int i = 5; i < 10; i++) new_arr[i] = (i + 1) * 10;

    for (int i = 0; i < 10; i++) printf("%d ", new_arr[i]);

    free(new_arr); // ν•΄μ 
    return 0;
}
```

### π” μ‘λ™ μ›λ¦¬ μ”μ•½

| λ™μ‘ μƒν™©       | μ„¤λ…                                                         |
| --------------- | ------------------------------------------------------------ |
| ν™•μ¥ μ‹         | μƒλ΅ ν™•λ³΄λ μμ—­μ€ μ΄κΈ°ν™”λμ§€ μ•μΌλ©°, κΈ°μ΅΄ λ°μ΄ν„°λ” μ μ§€λ¨   |
| μ¶•μ† μ‹         | μ• λ¶€λ¶„ λ°μ΄ν„°λ§ μ μ§€λκ³ , λ‚λ¨Έμ§€λ” μ κ±°λ¨                   |
| μ‹¤ν¨ μ‹         | `NULL` λ°ν™, μ›λ λ©”λ¨λ¦¬λ” μ†μƒλμ§€ μ•μ                     |
| `ptr == NULL`   | `malloc(new_size)`κ³Ό λ™μΌν•κ² λ™μ‘                           |
| `new_size == 0` | κµ¬ν„μ— λ”°λΌ `NULL`μ„ λ°ν™ν•κ±°λ‚, `free(ptr)`κ³Ό λ™μΌν•κ² λ™μ‘ν•  μ μμ (β οΈ μ£Όμ ν•„μ”) |

### π” realloc vs malloc λΉ„κµν‘

| ν•­λ©         | `malloc`              | `realloc`                      |
| ------------ | --------------------- | ------------------------------ |
| μ—­ν•          | μƒ λ©”λ¨λ¦¬ λΈ”λ΅μ„ ν• λ‹Ή | κΈ°μ΅΄ λ©”λ¨λ¦¬ λΈ”λ΅ ν¬κΈ° μ΅°μ      |
| μ…λ ¥ ν¬μΈν„°  | μ—†μ (`NULL`)         | κΈ°μ΅΄ λΈ”λ΅μ ν¬μΈν„° ν•„μ”        |
| μ΄κΈ°ν™” μ—¬λ¶€  | β μ΄κΈ°ν™”λμ§€ μ•μ     | β μƒ μμ—­λ„ μ΄κΈ°ν™”λμ§€ μ•μ    |
| μ‹¤ν¨ μ‹ μ²λ¦¬ | `NULL` λ°ν™           | `NULL` λ°ν™ + κΈ°μ΅΄ λ©”λ¨λ¦¬ λ³΄μ΅΄ |

### β οΈ μ£Όμμ‚¬ν•­

#### β— λ°ν™κ°’μ„ λ°”λ΅ λ®μ–΄μ“°μ§€ λ§ κ²ƒ

```
arr = realloc(arr, new_size); // β μ„ν—
```

λ§μ•½ μ‹¤ν¨ν•λ©΄ `arr`λ” `NULL`μ΄ λμ–΄ **κΈ°μ΅΄ λ©”λ¨λ¦¬λ¥Ό μƒκ³  λ©”λ¨λ¦¬ λ„μ λ°μƒ** κ°€λ¥μ„±μ΄ μλ‹¤.

**κ¶μ¥ λ°©μ‹:**

```
void *tmp = realloc(arr, new_size);
if (tmp != NULL) {
    arr = tmp;
} else {
    // κΈ°μ΅΄ arrλ” μ—¬μ „ν μ ν¨ β†’ free(arr);
}
```

### β… ν™μ© μ‚¬λ΅€

1. μ‚¬μ©μκ°€ μ…λ ¥ν• λ°μ΄ν„° κ°μμ— λ”°λΌ λ°°μ—΄μ„ μ μ—°ν•κ² ν™•μ¥ν•΄μ•Ό ν•  λ•
2. κµ¬μ΅°μ²΄ λ°°μ—΄, λ¬Έμμ—΄ λ²„νΌ, λ¦¬μ¤νΈ λ“±μ—μ„ **μ„±λ¥ μµμ ν™”**λ¥Ό μ„ν•΄ λ¶€λ¶„ ν• λ‹Ήν•κ³  μ μ§„μ μΌλ΅ ν™•μ¥ν•  λ•
3. λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ„ μ κ°ν•κΈ° μ„ν•΄ **μ‚¬μ©λ‰λ§νΌλ§ μ¬μ΅°μ •**ν•  λ•

### π§― λ©”λ¨λ¦¬ ν•΄μ 

```
free(λ³€μλ…);
```

`realloc`μ„ ν†µν•΄ λ³€κ²½λ μ£Όμ†λ¥Ό **λ°λ“μ‹ μ¶”μ ν•΄μ„ ν•΄μ **ν•΄μ•Ό ν•λ‹¤.
 μ΄κΈ° ν¬μΈν„°λ΅ ν•΄μ ν•  μ μ—†λ” κ²½μ°κ°€ μλ‹¤.

### π§  μ •λ¦¬ μ”μ•½

| ν•¨μ      | νΉμ§•                                      |
| --------- | ----------------------------------------- |
| `malloc`  | μ΄κΈ°ν™”λμ§€ μ•μ€ λ©”λ¨λ¦¬λ¥Ό μƒλ΅ ν• λ‹Ή        |
| `calloc`  | 0μΌλ΅ μ΄κΈ°ν™”λ λ©”λ¨λ¦¬λ¥Ό μƒλ΅ ν• λ‹Ή         |
| `realloc` | κΈ°μ΅΄ λ©”λ¨λ¦¬μ ν¬κΈ°λ¥Ό μ΅°μ •ν•λ©° λ°μ΄ν„° μ μ§€ |

## freeμ— μν• ν•΄μ 

### π“ `realloc` ν•¨μ β€“ λ©”λ¨λ¦¬ μ¬ν• λ‹Ή

#### π§Ύ κ°μ”

`realloc` ν•¨μλ” κΈ°μ΅΄μ— `malloc`, `calloc`, λλ” μ΄μ „ `realloc`μ— μν•΄ ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ ν¬κΈ°λ¥Ό λ³€κ²½ν•λ‹¤.
 μ¬ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ€ μƒ ν¬κΈ°μ— λ§κ² μ΅°μ •λλ©°, ν•„μ”ν• κ²½μ° λ‹¤λ¥Έ μ„μΉλ΅ μ΄λ™λ  μ μλ‹¤.

#### π§ ν•¨μ μ›ν•

```
void *realloc(void *ptr, size_t new_size);
```

#### π“¥ λ§¤κ°λ³€μ

| λ§¤κ°λ³€μ   | μ„¤λ…                                                         |
| ---------- | ------------------------------------------------------------ |
| `ptr`      | ν„μ¬ λ©”λ¨λ¦¬λ¥Ό κ°€λ¦¬ν‚¤λ” ν¬μΈν„° (NULLμΌ κ²½μ° `malloc`μ²λΌ λ™μ‘) |
| `new_size` | μƒλ΅­κ² μ”μ²­ν•  λ©”λ¨λ¦¬ ν¬κΈ° (λ°”μ΄νΈ λ‹¨μ„)                      |

#### π“¤ λ°ν™κ°’

| μƒν™© | λ°ν™κ°’                                               |
| ---- | ---------------------------------------------------- |
| μ„±κ³µ | μƒλ΅ ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ μ‹μ‘ μ£Όμ†                  |
| μ‹¤ν¨ | `NULL` λ°ν™, κΈ°μ΅΄ λ©”λ¨λ¦¬λ” κ·Έλ€λ΅ μ μ§€λ¨ (μ£Όμ ν•„μ”) |

#### π’΅ μ£Όμ” νΉμ§•

- κΈ°μ΅΄ λ°μ΄ν„°λ” μƒλ΅μ΄ λ©”λ¨λ¦¬ κ³µκ°„μ— **μλ™μΌλ΅ λ³µμ‚¬**λ¨.
- `ptr == NULL`μΈ κ²½μ° β†’ `malloc(new_size)`μ™€ λ™μΌν• ν¨κ³Ό.
- `new_size == 0`μΈ κ²½μ° β†’ `free(ptr)`κ³Ό λ™μΌν•λ©°, NULL λ°ν™.

#### π§ μ‚¬μ© μμ‹

```
int *arr = (int *)malloc(sizeof(int) * 5);
if (arr == NULL) return 1;

// λ” ν° λ°°μ—΄λ΅ ν™•μ¥
int *temp = (int *)realloc(arr, sizeof(int) * 10);
if (temp == NULL) {
    // μ¬ν• λ‹Ή μ‹¤ν¨ μ‹ arrλ” μ—¬μ „ν μ ν¨, λ°λ“μ‹ free(arr) ν•„μ”
    free(arr);
    return 1;
}
arr = temp;
```

#### β οΈ μ£Όμμ‚¬ν•­

| ν•­λ©               | μ„¤λ…                                                         |
| ------------------ | ------------------------------------------------------------ |
| λ°ν™κ°’ ν™•μΈ        | μ‹¤ν¨ μ‹ κΈ°μ΅΄ λ©”λ¨λ¦¬λ” μ μ§€λλ―€λ΅ `temp`μ— μ €μ¥ ν›„ `arr = temp` λ°©μ‹ μ‚¬μ© κ¶μ¥ |
| λ°μ΄ν„° μ μ‹¤ κ°€λ¥μ„± | μ¬ν• λ‹Ή μ¤‘ μ£Όμ† λ³€κ²½ λ°μƒ μ‹ μ΄μ „ λ©”λ¨λ¦¬ λΈ”λ΅μ€ λ” μ΄μƒ μ ν¨ν•μ§€ μ•μ |
| μ„±λ¥ κ³ λ ¤          | μμ£Ό ν¬κΈ°λ¥Ό λ³€κ²½ν•λ” κµ¬μ΅°λ³΄λ‹¨ **λ―Έλ¦¬ μ¶©λ¶„ν ν• λ‹Ή**ν•λ” κ²ƒμ΄ μ„±λ¥μƒ μ λ¦¬ν•  μ μμ |

### π“ `free` ν•¨μ β€“ λ©”λ¨λ¦¬ ν•΄μ 

#### π§Ύ κ°μ”

`free` ν•¨μλ” `malloc`, `calloc`, λλ” `realloc`μ— μν•΄ λ™μ μΌλ΅ ν• λ‹Ήλ λ©”λ¨λ¦¬ λΈ”λ΅μ„ ν•΄μ ν•μ—¬ μ‹μ¤ν…μ— λ°ν™ν•λ‹¤.

> β οΈ ν• λ² ν•΄μ ν• λ©”λ¨λ¦¬λ” λ‹¤μ‹ μ ‘κ·Όν•λ©΄ **μ •μλμ§€ μ•μ€ λ™μ‘(UB)** μ„ μΌμΌν‚¨λ‹¤.

#### π§ ν•¨μ μ›ν•

```
void free(void *ptr);
```

#### π“¥ λ§¤κ°λ³€μ

| λ§¤κ°λ³€μ | μ„¤λ…                                                         |
| -------- | ------------------------------------------------------------ |
| `ptr`    | ν•΄μ ν•  λ©”λ¨λ¦¬λ¥Ό κ°€λ¦¬ν‚¤λ” ν¬μΈν„°. NULLμΌ κ²½μ° μ•„λ¬΄ μ‘μ—…λ„ ν•μ§€ μ•μ. |

#### π“ μ‚¬μ© μμ‹

```
int *data = (int *)malloc(sizeof(int) * 10);
if (data != NULL) {
    // λ©”λ¨λ¦¬ μ‚¬μ©
    free(data);  // λ°λ“μ‹ ν•΄μ 
}
```

#### β οΈ μ£Όμμ‚¬ν•­

| ν•­λ©          | μ„¤λ…                                                         |
| ------------- | ------------------------------------------------------------ |
| NULL ν¬μΈν„°   | `free(NULL)`μ€ μ•„λ¬΄ μ‘μ—…λ„ ν•μ§€ μ•μΌλ©° μ•μ „ν•¨                |
| μ΄μ¤‘ ν•΄μ      | λ™μΌν• ν¬μΈν„°λ¥Ό λ‘ λ² μ΄μƒ `free()`ν•λ©΄ ν”„λ΅κ·Έλ¨μ΄ μ¶©λν•κ±°λ‚ μ¤λ¥ λ°μƒ |
| ν•΄μ  ν›„ μ ‘κ·Ό  | `free()` μ΄ν›„ ν•΄λ‹Ή λ©”λ¨λ¦¬ μ ‘κ·Ό μ‹ **λ―Έμ •μ λ™μ‘(UB)** λ°μƒ κ°€λ¥ |
| ν¬μΈν„° μ΄κΈ°ν™” | `free(ptr)` ν›„ `ptr = NULL`λ΅ μ΄κΈ°ν™”ν•λ” μµκ΄€μ΄ λ©”λ¨λ¦¬ μ¤λ¥ λ°©μ§€μ— λ„μ›€ λ¨ |

#### β… μ•μ „ν• ν•΄μ  μμ‹

```
char *buffer = (char *)malloc(100);
if (buffer) {
    // μ‚¬μ©
    free(buffer);
    buffer = NULL;  // μ΄μ¤‘ ν•΄μ  λ°©μ§€
}
```

### π“ `realloc` vs `free` λΉ„κµ μ”μ•½

| ν•­λ©         | `realloc`                                | `free`                      |
| ------------ | ---------------------------------------- | --------------------------- |
| λ©μ          | λ©”λ¨λ¦¬ λΈ”λ΅ ν¬κΈ° μ¬μ΅°μ •                  | λ™μ  λ©”λ¨λ¦¬ ν•΄μ             |
| μΈμ         | κΈ°μ΅΄ ν¬μΈν„°μ™€ μƒ ν¬κΈ°                    | κΈ°μ΅΄ ν¬μΈν„°                 |
| λ°ν™κ°’       | μƒ λ©”λ¨λ¦¬ μ£Όμ† (μ„±κ³µ μ‹), NULL (μ‹¤ν¨ μ‹) | μ—†μ (void ν•¨μ)            |
| μ‹¤ν¨ μ‹ λ™μ‘ | κΈ°μ΅΄ λ©”λ¨λ¦¬ μ μ§€                         | μ‘μ—… μ—†μ (NULLμ΄λ©΄ μ•μ „ν•¨) |
| μ„ν— μ”μ†    | μ‹¤ν¨ ν›„ ν¬μΈν„° κ°±μ‹  λ„λ½, λ©”λ¨λ¦¬ λ„μ    | μ΄μ¤‘ ν•΄μ , ν•΄μ  ν›„ μ ‘κ·Ό     |

# 8.2 λ©”λ¨λ¦¬ λ„μ λ°©μ§€ λ° ν¬μΈν„° μ΄κΈ°ν™”

## NULL ν¬μΈν„°

### π“ `NULL ν¬μΈν„°` (Null Pointer)

#### π§Ύ κ°μ”

C μ–Έμ–΄μ—μ„ `NULL ν¬μΈν„°`λ€, **μ–΄λ–¤ κ°μ²΄λ„ κ°€λ¦¬ν‚¤μ§€ μ•λ” ν¬μΈν„°**λ¥Ό μλ―Έν•λ‹¤.
 μ΄λ” ν¬μΈν„°κ°€ μ•„μ§ **μ–΄λ–¤ μ ν¨ν• λ©”λ¨λ¦¬ μ£Όμ†λ„ ν• λ‹Ήλ°›μ§€ μ•μ€ μƒνƒ**λ¥Ό λ…μ‹μ μΌλ΅ λ‚νƒ€λ‚Ό λ• μ‚¬μ©λλ‹¤.

#### π§ μ„ μ–Έ λ°©λ²•

```
#include <stddef.h>

int *ptr = NULL;  // λλ”
int *ptr = 0;     // (Cμ—μ„ ν—μ©λμ§€λ§ κ¶μ¥λμ§€ μ•μ)
```

> π“ C99 μ΄ν›„λ΅λ” `NULL`μ€ `((void*)0)`λ΅ μ •μλμ–΄ μλ‹¤.

#### π§  μ‚¬μ© λ©μ 

| μ©λ„      | μ„¤λ…                                           |
| --------- | ---------------------------------------------- |
| μ΄κΈ°ν™”    | ν¬μΈν„° μ„ μ–Έ μ‹ λ…ν™•ν• μ΄κΈ°κ°’ λ¶€μ—¬              |
| μƒνƒ ν™•μΈ | λ™μ  λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨ μ—¬λ¶€ κ²€μ‚¬                |
| μμ™Έ μ²λ¦¬ | μ΅°κ±΄ λ¶„κΈ° μ‹ μ ν¨ ν¬μΈν„° μ—¬λ¶€ ν™•μΈ             |
| μ•μ „ ν•΄μ  | `free()` μ΄ν›„ ν¬μΈν„° μ΄κΈ°ν™”ν•μ—¬ μ΄μ¤‘ ν•΄μ  λ°©μ§€ |

#### β… μ‚¬μ© μμ‹

```
int *data = (int *)malloc(sizeof(int) * 10);
if (data == NULL) {
    // λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨ μ‹ μ²λ¦¬
}
...
free(data);
data = NULL;  // μ•μ „ν•κ² ν¬μΈν„° μ΄κΈ°ν™”
```

#### β οΈ μ£Όμμ‚¬ν•­

| ν•­λ©        | μ„¤λ…                                                         |
| ----------- | ------------------------------------------------------------ |
| μλ»λ μ ‘κ·Ό | `*ptr` μ²λΌ NULLμ„ μ—­μ°Έμ΅°ν•λ©΄ **Segmentation Fault** λ°μƒ    |
| λΉ„κµ μ—°μ‚°   | λ°λ“μ‹ `if (ptr == NULL)` λλ” `if (!ptr)` λ“±μΌλ΅ ν™•μΈ       |
| NULL β‰  0    | Cμ—μ„λ” NULLμ΄ 0μΌλ΅ μ •μλμ§€λ§, ν¬μΈν„°μ™€ μ •μλ” μλ―Έμ μΌλ΅ λ‹¤λ¥΄λ―€λ΅ **`NULL` μ‚¬μ©μ„ κ¶μ¥** |

#### π’£ μλ»λ μ‚¬μ© μ

```
int *ptr = NULL;
*ptr = 100;     // β β†’ λ°νƒ€μ„ μ—λ¬ (Segmentation Fault)
```

### π” NULL ν¬μΈν„°λ¥Ό ν™μ©ν• μ•μ „ν• λ©”λ¨λ¦¬ κ΄€λ¦¬

#### β›‘οΈ λ™μ  λ©”λ¨λ¦¬ ν¨ν„΄ μμ‹

```
int *buffer = (int *)malloc(100 * sizeof(int));
if (buffer == NULL) {
    // λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨
    return;
}

// μ‚¬μ© ν›„
free(buffer);
buffer = NULL;  // μ΄μ¤‘ ν•΄μ  λ°©μ§€
```

### π“ NULL ν¬μΈν„° μ”μ•½ ν‘

| ν•­λ©        | λ‚΄μ©                                           |
| ----------- | ---------------------------------------------- |
| μ •μ        | μ•„λ¬΄ κ²ƒλ„ κ°€λ¦¬ν‚¤μ§€ μ•λ” ν¬μΈν„°                 |
| κ°’          | `((void*)0)` λλ” `0` (Cμ—μ„ ν—μ©)             |
| μ£Ό μ©λ„     | μ΄κΈ°ν™”, λΉ„κµ, μ¤λ¥ μ²λ¦¬, μ•μ „ν• ν•΄μ  λ“±        |
| μ—­μ°Έμ΅° μ„ν— | β `*ptr` κΈμ§€ β†’ μ„Έκ·Έλ©ν…μ΄μ… μ¤λ¥ λ°μƒ         |
| κ¶μ¥ λ°©μ‹   | ν•­μƒ `ptr == NULL` λλ” `ptr != NULL`μΌλ΅ κ²€μ‚¬ |

### π§  μ‹¬ν™” κ°λ…

#### π”Έ NULL vs 0 vs '\0'

| ν‘ν„   | μλ―Έ                                       |
| ------ | ------------------------------------------ |
| `NULL` | ν¬μΈν„° μƒμ "μ—†μ" μλ―Έ                    |
| `0`    | μ •μ 0                                     |
| `'\0'` | λ¬Έμν• null, μ¦‰ ASCII 0 (λ¬Έμμ—΄ μΆ…λ£ λ¬Έμ) |

> π‘† κ°κ°μ€ νƒ€μ…κ³Ό μλ―Έκ°€ λ‹¤λ¥΄λ©°, μ μ ν• λ¬Έλ§¥μ—μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

## ν•΄μ  ν›„ μ‚¬μ© λ°©μ§€

### π“ ν•΄μ  ν›„ μ‚¬μ© λ°©μ§€ (`Use After Free`)

#### π§Ύ κ°μ”

`Use After Free`λ€, **μ΄λ―Έ `free()` ν•¨μλ¥Ό ν†µν•΄ ν•΄μ λ λ©”λ¨λ¦¬ μμ—­μ— λ‹¤μ‹ μ ‘κ·Όν•κ±°λ‚ μ‚¬μ©ν•λ” ν–‰μ„**λ¥Ό λ§ν•λ‹¤.
 μ΄λ” μ •μλμ§€ μ•μ€ λ™μ‘(Undefined Behavior)μ„ μ λ°ν•λ©°, ν”„λ΅κ·Έλ¨μ΄ μκΈ°μΉ μ•κ² **μ¤λ¥, λ°μ΄ν„° μ†μƒ, λ³΄μ• μ·¨μ•½μ ** λ“±μ„ μΌμΌν‚¬ μ μλ‹¤.

### π”¥ λ€ν‘μ μΈ μλ»λ μμ‹

```
int *data = (int *)malloc(sizeof(int) * 5);
free(data);

data[0] = 10;    // β ν•΄μ λ λ©”λ¨λ¦¬μ— μ ‘κ·Ό β†’ Use After Free μ¤λ¥
```

> β οΈ μ΄ μ½”λ“λ” **μ„Έκ·Έλ©ν…μ΄μ… ν΄νΈ(Segmentation Fault)** λλ” **λ¬΄μλ―Έν• κ²°κ³Ό**λ¥Ό μΌμΌν‚¬ μ μλ‹¤.

### β… μ•μ „ν• λ©”λ¨λ¦¬ ν•΄μ  ν¨ν„΄

```
int *data = (int *)malloc(sizeof(int) * 5);
if (data == NULL) return;

// λ©”λ¨λ¦¬ μ‚¬μ©
free(data);
data = NULL;  // β… μ•μ „ν• μ΄κΈ°ν™”
```

> π’΅ `free()` ν›„ λ°λ“μ‹ ν¬μΈν„°λ¥Ό `NULL`λ΅ μ„¤μ •ν•λ©΄, **μ΄μ¤‘ ν•΄μ **μ™€ **ν•΄μ  ν›„ μ‚¬μ©** λ¨λ‘ λ°©μ§€ν•  μ μλ‹¤.

### π“ ν•΄μ  ν›„ μ‚¬μ© vs μ•μ „ν• μ‚¬μ© λΉ„κµ

| ν•­λ©             | μλ»λ μ½”λ“                | μ•μ „ν• μ½”λ“                    |
| ---------------- | -------------------------- | ------------------------------ |
| ν•΄μ  ν›„ μ ‘κ·Ό     | `free(ptr); ptr[0] = ...;` | `free(ptr); ptr = NULL;`       |
| ν•΄μ  ν›„ μ¶λ ¥     | `printf("%d", *ptr);`      | `if (ptr) printf("%d", *ptr);` |
| μ΄μ¤‘ ν•΄μ  κ°€λ¥μ„± | `free(ptr); free(ptr);`    | `free(ptr); ptr = NULL;`       |

### β οΈ ν•΄μ  ν›„ μ‚¬μ©μ μ„ν—

| μ„ν— μ”μ†     | μ„¤λ…                                                   |
| ------------- | ------------------------------------------------------ |
| ν”„λ΅κ·Έλ¨ μ¶©λ | μ ‘κ·Ό μ¤‘ Segmentation Fault λ°μƒ κ°€λ¥                   |
| λ°μ΄ν„° ν›Όμ†   | λ‹¤λ¥Έ ν• λ‹Ή μ”μ²­μ— μν•΄ λ©”λ¨λ¦¬ μμ—­μ΄ μ¬μ‚¬μ©λ  μ μμ   |
| λ³΄μ• μ·¨μ•½μ    | ν•΄μ»¤κ°€ κ³ μλ΅ μ΅°μ‘λ λ°μ΄ν„°λ¥Ό μ‚½μ… κ°€λ¥ (Heap Exploit) |

### π§  μ‹¬ν™”: `Use After Free` λ°μƒ μ›μΈ

- **ν¬μΈν„°λ¥Ό μ—¬λ¬ κ° λ³µμ‚¬ν•΄μ„ μ‚¬μ©ν• κ²½μ°**

  ```
  int *a = malloc(4);  
  int *b = a;  
  free(a);  
  *b = 10;   // bλ” μ—¬μ „ν ν•΄μ λ μμ—­μ„ κ°€λ¦¬ν‚΄
  ```

- **`realloc()` μ‚¬μ© μ‹ μ‹¤ν¨ν–λ”λ° μ›λ ν¬μΈν„°λ¥Ό κ·Έλ€λ΅ μ‚¬μ©ν• κ²½μ°**

  ```
  int *arr = malloc(10);
  int *tmp = realloc(arr, 1000000000);  // μ‹¤ν¨ κ°€λ¥
  if (tmp == NULL) {
      *arr = 100;  // μ„ν—: arrμ΄ μ΄λ―Έ ν•΄μ λμ„ μλ„ μμ
  }
  ```

### π›΅οΈ λ°©μ§€ μ „λµ

| μ „λµ                      | μ„¤λ…                                                      |
| ------------------------- | --------------------------------------------------------- |
| `free()` ν›„ NULLλ΅ μ΄κΈ°ν™” | κ°€μ¥ κΈ°λ³Έμ μ΄λ©΄μ„ κ°•λ ¥ν• λ³΄νΈ λ°©λ²•                        |
| ν¬μΈν„° κ³µμ  μ§€μ–‘          | λ™μΌν• λ©”λ¨λ¦¬ μ£Όμ†λ¥Ό μ—¬λ¬ ν¬μΈν„°κ°€ κ³µμ ν•μ§€ μ•λ„λ΅ μ„¤κ³„   |
| λ™μ  μμ—­ μƒλ… μ£ΌκΈ° κ΄€λ¦¬  | ν¬μΈν„°κ°€ κ°€λ¦¬ν‚¤λ” λ©”λ¨λ¦¬μ μ†μ κ¶κ³Ό μλ…μ„ λ…ν™•ν μ •μ    |
| λ„κµ¬ ν™μ©                 | `Valgrind`, `AddressSanitizer` λ“±μ„ ν†µν•΄ μ‹¤μ‹κ°„ κ°μ§€ κ°€λ¥ |

### π§ Valgrind μμ‹

```
valgrind --leak-check=full ./your_program
```

> β… `Use After Free`, λ©”λ¨λ¦¬ λ„μ, μ΄μ¤‘ ν•΄μ  λ“± λ‹¤μ–‘ν• μ¤λ¥λ¥Ό νƒμ§€ν•  μ μμ

### π” μ½”λ“ μ: μ•μ „ν• λ©”λ¨λ¦¬ ν•΄μ  κµ¬μ΅°

```
void safe_free(int **ptr) {
    if (*ptr != NULL) {
        free(*ptr);
        *ptr = NULL;
    }
}

int main() {
    int *data = malloc(100);
    // μ‚¬μ©
    safe_free(&data);  // ν¬μΈν„° μμ²΄λ¥Ό NULLλ΅ μ„¤μ •
}
```

### π§  μ”μ•½ μ •λ¦¬

| ν•µμ‹¬ ν¬μΈνΈ       | μ„¤λ…                                                   |
| ----------------- | ------------------------------------------------------ |
| ν•΄μ  ν›„ μ ‘κ·Ό κΈμ§€ | `free()` μ΄ν›„ λ©”λ¨λ¦¬λ” μ ν¨ν•μ§€ μ•μ                   |
| NULL μ΄κΈ°ν™” μµκ΄€  | `ptr = NULL;` λ°λ“μ‹ μ μ©                              |
| λ””λ²„κΉ… λ„κµ¬ ν™μ©  | `Valgrind`, `ASAN`μΌλ΅ λ™μ  κ²€μ‚¬ κ°€λ¥                  |
| ν¬μΈν„° λ³µμ‚¬ μ£Όμ  | μ—¬λ¬ ν¬μΈν„°κ°€ λ™μΌ λ©”λ¨λ¦¬λ¥Ό κ°€λ¦¬ν‚¬ κ²½μ° κµ¬μ΅° μ„¤κ³„ ν•„μ” |

# 8.3 λ™μ  λ°°μ—΄ λ° κµ¬μ΅°μ²΄μ ν™μ©

### π§Ύ κ°μ”

λ™μ  λ©”λ¨λ¦¬λ¥Ό μ‚¬μ©ν•λ©΄, **λ°°μ—΄μ ν¬κΈ°λ¥Ό μ»΄νμΌ νƒ€μ„μ΄ μ•„λ‹ λ°νƒ€μ„μ— κ²°μ •ν•  μ μμΌλ©°**,
 κµ¬μ΅°μ²΄λ¥Ό ν¬ν•¨ν• λ³µν•© μλ£ν•μ— λ€ν•΄μ„λ„ μ μ—°ν•κ² λ©”λ¨λ¦¬λ¥Ό κ΄€λ¦¬ν•  μ μλ‹¤.
 μ΄λ” **λ°μ΄ν„° ν¬κΈ°λ¥Ό μμΈ΅ν•κΈ° μ–΄λ ¤μ΄ κ²½μ°**, μλ¥Ό λ“¤μ–΄ νμΌ μ…λ ¥, μ‚¬μ©μ μ…λ ¥ λ“±μ— νΉν μ μ©ν•λ‹¤.

### π“ 1. λ™μ  λ°°μ—΄μ ν™μ©

#### π”Ή κΈ°λ³Έ κµ¬μ΅°

```
int *arr = (int *)malloc(sizeof(int) * n);
```

μ—¬κΈ°μ„ `n`μ€ λ°νƒ€μ„μ— κ²°μ •λλ” λ°°μ—΄ ν¬κΈ°μ΄λ©°, λ©”λ¨λ¦¬λ” `heap` μμ—­μ— λ™μ μΌλ΅ ν• λ‹Ήλλ‹¤.

#### π“ μμ : μ‚¬μ©μ μ…λ ¥μ— λ”°λ¥Έ μ •μ λ°°μ—΄

```
#include <stdio.h>
#include <stdlib.h>

int main() {
    int n;
    printf("λ°°μ—΄ ν¬κΈ° μ…λ ¥: ");
    scanf("%d", &n);

    int *arr = (int *)malloc(sizeof(int) * n);
    if (arr == NULL) {
        perror("λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨");
        return 1;
    }

    for (int i = 0; i < n; i++) {
        arr[i] = i * 10;
        printf("arr[%d] = %d\n", i, arr[i]);
    }

    free(arr);
    return 0;
}
```

### π“ 2. κµ¬μ΅°μ²΄ λ°°μ—΄μ λ™μ  ν• λ‹Ή

#### π”Ή κµ¬μ΅°μ²΄ μ •μ

```
typedef struct {
    char name[20];
    int age;
} Person;
```

#### π”Ή λ™μ  λ°°μ—΄ ν• λ‹Ή

```
Person *group = (Person *)malloc(sizeof(Person) * count);
```

#### π“ μμ : κµ¬μ΅°μ²΄ λ°°μ—΄ μ‚¬μ©

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct {
    char name[20];
    int age;
} Person;

int main() {
    int count;
    printf("μ‚¬λ μ μ…λ ¥: ");
    scanf("%d", &count);

    Person *people = (Person *)calloc(count, sizeof(Person));
    if (people == NULL) {
        perror("λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨");
        return 1;
    }

    for (int i = 0; i < count; i++) {
        printf("μ΄λ¦„ μ…λ ¥: ");
        scanf("%s", people[i].name);
        printf("λ‚μ΄ μ…λ ¥: ");
        scanf("%d", &people[i].age);
    }

    printf("\n== μ €μ¥λ μΈμ› ==\n");
    for (int i = 0; i < count; i++) {
        printf("μ΄λ¦„: %s, λ‚μ΄: %d\n", people[i].name, people[i].age);
    }

    free(people);
    return 0;
}
```

### π“ 3. κµ¬μ΅°μ²΄ λ‚΄ ν¬μΈν„° ν•„λ“μ λ™μ  ν• λ‹Ή

#### π”Ή κµ¬μ΅°μ²΄ μ •μ μμ‹

```
typedef struct {
    char *name;
    int *scores;
    int num_scores;
} Student;
```

#### π“ μμ : κµ¬μ΅°μ²΄ λ‚΄λ¶€ ν¬μΈν„° ν™μ©

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct {
    char *name;
    int *scores;
    int num_scores;
} Student;

int main() {
    Student s;

    s.name = (char *)malloc(30);
    s.num_scores = 3;
    s.scores = (int *)malloc(sizeof(int) * s.num_scores);

    strcpy(s.name, "Alice");
    s.scores[0] = 90;
    s.scores[1] = 85;
    s.scores[2] = 88;

    printf("μ΄λ¦„: %s\n", s.name);
    for (int i = 0; i < s.num_scores; i++) {
        printf("μ μ[%d]: %d\n", i, s.scores[i]);
    }

    free(s.name);
    free(s.scores);
    return 0;
}
```

### β οΈ μ£Όμμ‚¬ν•­ μ •λ¦¬

| ν•­λ©                     | μ„¤λ…                                                         |
| ------------------------ | ------------------------------------------------------------ |
| ν• λ‹Ή μ‹¤ν¨ κ²€μ‚¬           | `malloc` λλ” `calloc` μ‚¬μ© ν›„ λ°λ“μ‹ `NULL` κ²€μ‚¬            |
| κµ¬μ΅°μ²΄ λ‚΄ ν¬μΈν„° ν•΄μ     | κµ¬μ΅°μ²΄μ— λ™μ  ν¬μΈν„° ν•„λ“κ°€ μμ„ κ²½μ° κ°κ° `free()` ν•„μ”     |
| μ΄μ¤‘ ν¬μΈν„° ν™μ© μ‹ μ£Όμ | λ‹¤μ°¨μ› λ°°μ—΄μ²λΌ μ‚¬μ©ν•  κ²½μ° κ° ν–‰μ— λ€ν•΄μ„λ„ `malloc`/`free` ν•„μ” |
| `realloc` μ‚¬μ© μ‹ μ£Όμ   | μ‹¤ν¨ μ‹ μ›λ ν¬μΈν„° μ ν¨ν•λ―€λ΅ λ³„λ„ ν¬μΈν„°λ΅ μ„μ‹ λ³΄κ΄€ κ¶μ¥  |

### π“ μ”μ•½ λΉ„κµ

| ν•­λ©                  | μ„¤λ…                              |
| --------------------- | --------------------------------- |
| μ •μ  λ°°μ—΄             | ν¬κΈ°κ°€ κ³ μ •λ¨, μ¤νƒ μμ—­ μ‚¬μ©     |
| λ™μ  λ°°μ—΄             | ν¬κΈ° μ λ™μ , ν™ μμ—­ μ‚¬μ©         |
| κµ¬μ΅°μ²΄ λ°°μ—΄ λ™μ  ν• λ‹Ή | `sizeof(κµ¬μ΅°μ²΄) * n` ν™μ©         |
| κµ¬μ΅°μ²΄ λ‚΄ ν¬μΈν„° μ‚¬μ© | λ‚΄λ¶€ λ©¤λ²„λ³„λ΅ λ³„λ„ λ™μ  ν• λ‹Ή ν•„μ” |

